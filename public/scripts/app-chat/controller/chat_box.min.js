define(["util","eventemitter","app-chat/view/build/template"],function(t,e,n){function i(t,e){this.el=t,this.message=e}var s=t,a=e;return i.prototype={elements:{".chat-box":"$chatbox",".chat-message":"$ChatMsgRegion"}},i=s.eventify(i,a),s.include(i,{init:function(){this._render(),this._initDom(),this._initEvent()},_render:function(){var t=this._template();this.el.innerHTML=t},_template:function(){return n("chat-box",{})},_initDom:function(){for(var t in this.elements)this[this.elements[t]]=s.$(t,this.el)},_initEvent:function(){s.delegate(this.$chatbox,"textarea","keyup",this.EnterSendMsg.bind(this)),s.delegate(this.$chatbox,"button","click",this.BtnSendMsg.bind(this)),this.on("acceptMsg",this.addMessage.bind(this))},EnterSendMsg:function(t){13!==t.keyCode&&13!==t.which||this._sendMsg(t.target)},BtnSendMsg:function(t){var e=s.$("textarea",t.target.parentElement);this._sendMsg(e)},_sendMsg:function(t){var e=t.value;t.value="",this.emit("sendMsg",e)},addMessage:function(t,e){var n={imgUrl:t.user.image,sign:t.user.sign,author:t.user.name,content:t.content},i=this._template_msg(e,n),a=s.template(i,"msg");this.$ChatMsgRegion.appendChild(a)},_template_msg:function(t,e){return"my"===t?n("my-msg",e):"other"===t?n("other-msg",e):void 0}}),i});