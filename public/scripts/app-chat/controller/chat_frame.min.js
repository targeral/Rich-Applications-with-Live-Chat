define(["util","eventemitter","app-chat/view/build/template"],function(t,e,i){function n(t,e){this.el=t,this.user=e}var a=t;return n.prototype={constructor:n,elements:{".sign":"$sign",".chat-msg":"$chatMsg","input[type=search]":"$search",nav:"$nav","#leave":"$leave"}},n=a.eventify(n,e),a.include(n,{init:function(){this._render(),this._initDom(),this._initEvent()},_render:function(){this._template()},_template:function(){var t=i("chat_frame",{author:this.user.getAuthor(),person_sign:this.user.getPersonSign(),image:this.user.getImgUrl()});this.el.innerHTML=t},_initDom:function(){for(var t in this.elements)this[this.elements[t]]=a.$(t,this.el)},_initEvent:function(){a.delegate(this.$chatMsg,"p","click",this.edit.bind(this)),a.delegate(this.$chatMsg,"input","blur",this.edited.bind(this),{userCapture:!0}),a.delegate(this.$chatMsg,"input","keyup",this.edited.bind(this)),a.on(this.$search,"keyup",this.search.bind(this)),a.delegate(this.$nav,"a","click",this.tab.bind(this)),a.on(this.$leave,"click",this.leave.bind(this))},edit:function(t){var e=t.target,i=e.parentElement;this._edit(e,i)},_edit:function(t,e){var i=t.textContent,n=document.createElement("input");n.className="sign",n.dataset.editable="",n.value=i,e.removeChild(t),e.appendChild(n),n.focus()},edited:function(t){if("keyup"!==t.type||13==t.keyCode){if("keyup"===t.type&&13==t.keyCode)return void a.$(".sign",this.$chatMsg).blur();var e=t.target,i=e.parentElement;this._edited(e,i)}},_edited:function(t,e){var i=t.value,n=document.createElement("p");n.className="sign",n.dataset.editable="",n.textContent=i,e.removeChild(t),e.appendChild(n);var a=this.user.setUser({sign:i});this._updateUser(a)},_updateUser:function(t){},search:function(){},tab:function(t){var e=t.target,i=t.currentTarget,n=e.getAttribute("data-chatid");this._tab(e,i),this.emit("tabChange",n)},_tab:function(t,e){var i=a.$All("a",e);i=a.makeArray(i),i.forEach(function(t){t.classList.remove("active")}),t.classList.add("active")},leave:function(){this.emit("leave")}}),n});